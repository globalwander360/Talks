
üìÅ initiate-event-data.service.ts

getCxtProdCode(processingEntityId: string, wfr: string): Observable<CxtProdCode[]> {
  return this.staticDataService
    .getCxtProdCode('BNPPUID', undefined, undefined, 'body', false)
    .pipe(
      switchMap((response: CxtProdCode[]) => {
        // ‚úÖ Future-proofing: agar aur mapping/filtering karni ho toh yahan kare
        return this.getCachedCxtProdCode().pipe(
          map((allCodes: CxtProdCode[]) => {
            // ‚úÖ IDs extract karo
            const cxtProdCodeIds: string[] = response.map(code => code.productCode);

            // ‚úÖ Map bana lo ID ‚Üí Object (fast lookup)
            const cxtProdCodeMap: Record<string, CxtProdCode> = keyBy(allCodes, 'productCode');

            // ‚úÖ Sorting logic (optional, jaise transaction properties me tha)
            return sortBy(
              compact(cxtProdCodeIds.map(id => cxtProdCodeMap[id])),
              'productCode'
            );
          })
        );
      })
    );
}

// ‚úÖ Helper for caching
private cxtProdCodeCache$?: Observable<CxtProdCode[]>;

getCachedCxtProdCode(): Observable<CxtProdCode[]> {
  if (!this.cxtProdCodeCache$) {
    this.cxtProdCodeCache$ = this.staticDataService
      .getCxtProdCode('BNPPUID', undefined, undefined, 'body', false)
      .pipe(shareReplay(1));
  }
  return this.cxtProdCodeCache$;
}


---

üî• Step 2: Blotter.component.ts ‚Äì CASE add karna

üìÅ blotter.component.ts

case BUFFER_FUNCTION.GET_CXT_PROD_CODE:
  this.getThrowbacks()
    .pipe(concatMap(() => this.initiateEventDataService.getCxtProdCode(data.id, keys)))
    .subscribe((cxtProdCodes: CxtProdCode[]) => {
      const productCodeLabels = cxtProdCodes
        .filter(code => code.productCode) // ‚úÖ Filter if needed
        .map(code => code.productCode)
        .join(', ');

      return onLoad({ ...data, productCodeLabels });
    });
  break;


---

üî• Step 3: Enum mein entry add karo

üìÅ buffer-function.enum.ts (ya jaha define hai)

export enum BUFFER_FUNCTION {
  GET_USER_NAME_BY_ID = 'GET_USER_NAME_BY_ID',
  GET_TRANSACTION_PROPERTIES = 'GET_TRANSACTION_PROPERTIES',
  GET_CXT_PROD_CODE = 'GET_CXT_PROD_CODE'  // ‚úÖ NEW
}

